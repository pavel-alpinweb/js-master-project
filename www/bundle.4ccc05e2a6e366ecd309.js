(function(){"use strict";var __webpack_modules__={781:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){function parse(value=""){if(value.startsWith("="))try{return eval(value.slice(1))}catch(t){return value}return value}__webpack_require__.d(__webpack_exports__,{Q:function(){return parse}})}},__webpack_module_cache__={};function __webpack_require__(t){if(__webpack_module_cache__[t])return __webpack_module_cache__[t].exports;var e=__webpack_module_cache__[t]={exports:{}};return __webpack_modules__[t](e,e.exports,__webpack_require__),e.exports}__webpack_require__.d=function(t,e){for(var s in e)__webpack_require__.o(e,s)&&!__webpack_require__.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},__webpack_require__.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},function(){class t{constructor(t){this.$el="string"==typeof t?document.querySelector(t):t}html(t){return"string"==typeof t?(this.$el.innerHTML=t,this):this.$el.outerHTML.trim()}set text(t){"input"===this.$el.tagName.toLowerCase()&&(this.$el.value=t.trim()),this.$el.textContent=t}get text(){return"input"===this.$el.tagName.toLowerCase()?this.$el.value.trim():this.$el.textContent.trim()}width(t="auto"){return this.$el.style.width="string"==typeof t?t:t+"px",this}height(t="auto"){return this.$el.style.height="string"==typeof t?t:t+"px",this}css(t={}){Object.keys(t).forEach((e=>{this.$el.style[e]=t[e]}))}getStyles(t=[]){return t.reduce(((t,e)=>(t[e]=this.$el.style[e],t)),{})}id(t){if(t){const t=this.id().split(":");return{row:+t[0],col:+t[1]}}return this.data.id}focus(){return this.$el.focus(),this}attr(t,e){return e?(this.$el.setAttribute(t,e),this):this.$el.getAttribute(t)}addClass(t=""){return this.$el.classList.add(t),this}removeClass(t=""){return this.$el.classList.remove(t),this}clear(){return this.html(""),this}on(t,e){this.$el.addEventListener(t,e)}off(t,e){this.$el.removeEventListener(t,e)}append(e){return e instanceof t&&(e=e.$el),Element.prototype.append?this.$el.append(e):this.$el.appendChild(e),this}findAll(t){return this.$el.querySelectorAll(t)}find(t){return e(this.$el.querySelector(t))}get data(){return this.$el.dataset}closest(t){return e(this.$el.closest(t))}getCoords(){return this.$el.getBoundingClientRect()}}function e(e){return new t(e)}e.create=(t,s="")=>{const n=document.createElement(t);return s&&n.classList.add(s),e(n)};class s{static get path(){return window.location.hash.slice(1)}static get param(){return s.path.split("/")[1]}static get page(){return s.path.split("/")[0]}static push(t){window.location.replace(`#${t}`)}}function n(){return e.create("div","loader").html('\n    <div class="lds-spinner">\n      <div></div>\n      <div></div>\n      <div></div>\n      <div></div>\n      <div></div>\n      <div></div>\n      <div></div>\n      <div></div>\n      <div></div>\n      <div></div>\n      <div></div>\n      <div></div>\n    </div>\n  ')}class r{constructor(t){this.params=t}getRoot(){throw new Error('Method "getRoot" should be implemented')}afterRender(){}destroy(){}}function i(t,e){return t>e&&([e,t]=[t,e]),new Array(e-t+1).fill("").map(((e,s)=>t+s))}function a(t,e){if(!e)return JSON.parse(localStorage.getItem(t));localStorage.setItem(t,JSON.stringify(e))}function o(t){const e=t.replace("excel:",""),s=a(t),n=new Date(Number(s.openTime));return`\n    <li class="db__record">\n      <a href="#excel/${e}">${s.tableName}</a>\n      <strong>${n.toLocaleString("ru-RU")}</strong>\n    </li>\n  `}const c="TABLE_RESIZE",l="CHANGE_TEXT",u="APPLY_STYLE",h="CHANGE_STYLES",d="CHANGE_TABLE_NAME",p="TABLE_OPEN_TIME";function f(t,e){let s,n;switch(e.type){case c:return s="col"===e.data.resizeType?"colState":"rowState",{...t,[s]:m(t,s,e)};case l:return s="dataState",{...t,currentText:e.data.value,[s]:m(t,s,e)};case h:return{...t,currentStyles:e.data};case u:return s="stylesState",n=t[s]||{},e.data.ids.forEach((t=>{n[t]={...n[t],...e.data.value}})),{...t,[s]:n,currentStyles:{...t.currentStyles,...e.data.value}};case d:return{...t,tableName:e.text};case p:return console.log("UTS",e.uts),{...t,openTime:e.uts};default:return t}}function m(t,e,s){const n=t[e]||{};return n[s.data.id]=s.data.value,n}class b{constructor(){this.listeners={}}emit(t,...e){return!!Array.isArray(this.listeners[t])&&(this.listeners[t].forEach((t=>{t(...e)})),!0)}subscribe(t,e){return this.listeners[t]=this.listeners[t]||[],this.listeners[t].push(e),()=>{this.listeners[t]=this.listeners[t].filter((t=>t!==e))}}}class v{constructor(t){this.store=t,this.sub=null,this.prevState={}}subscribeComponents(t){this.prevState=this.store.getState(),this.sub=this.store.subscribe((e=>{Object.keys(e).forEach((s=>{var n,r;n=this.prevState[s],r=e[s],("object"==typeof n&&"object"==typeof r?JSON.stringify(n)===JSON.stringify(r):n===r)||t.forEach((t=>{if(t.isWatching(s)){const n={[s]:e[s]};t.storeChanged(n)}}))})),this.prevState=this.store.getState()}))}unsubscribeFromStore(){this.sub.unsubscribe()}}class g{constructor(t){this.components=t.components||[],this.store=t.store,this.emitter=new b,this.subscriber=new v(this.store)}getRoot(){const t=e.create("div","excel"),s={emitter:this.emitter,store:this.store};return this.components=this.components.map((n=>{const r=e.create("div",n.className),i=new n(r,s);return r.html(i.toHTML()),t.append(r),i})),t}init(){this.subscriber.subscribeComponents(this.components),this.components.forEach((t=>t.init()));const t=new Date;var e;this.store.dispatch((e=t.getTime(),{type:p,uts:e}))}destroy(){this.subscriber.unsubscribeFromStore(),this.components.forEach((t=>t.destroy()))}}function _(t){return"on"+("string"!=typeof(e=t)?"":e.charAt(0).toUpperCase()+e.slice(1));var e}class w extends class{constructor(t,e=[]){if(!t)throw new Error("No $root provided for DomListener");this.$root=t,this.listeners=e}initDOMListeners(){this.listeners.forEach((t=>{const e=_(t);if(!this[e])throw new Error(`Method '${e}' is not exist in component: ${this.name}`);this[e]=this[e].bind(this),this.$root.on(t,this[e])}))}removeDOMListeners(){this.listeners.forEach((t=>{const e=_(t);this.$root.off(t,this[e])}))}}{constructor(t,e={}){super(t,e.listeners),this.name=e.name||"",this.emitter=e.emitter,this.store=e.store,this.unsubscribers=[],this.subscribe=e.subscribe||[],this.prepare()}toHTML(){return""}$emit(t,...e){this.emitter.emit(t,...e)}$on(t,e){const s=this.emitter.subscribe(t,e);this.unsubscribers.push(s)}$dispatch(t){this.store.dispatch(t)}storeChanged(){}isWatching(t){return this.subscribe.includes(t)}prepare(){}init(){this.initDOMListeners()}destroy(){this.removeDOMListeners(),this.unsubscribers.forEach((t=>t()))}}class y extends w{constructor(t,e){super(t,{name:"Header",listeners:["input","click"],...e})}toHTML(){return'\n      <input \n        id="header-input"\n        type="text" \n        class="input" \n        value="Новая таблица" \n      />\n\n      <div>\n\n        <div class="button" data-delete>\n          <i class="material-icons" data-action="delete">delete</i>\n        </div>\n\n        <div class="button">\n          <a href="#dashboard">\n            <i class="material-icons">exit_to_app</i>\n          </a>\n        </div>\n\n      </div>\n    '}init(){super.init(),this.$headerInput=this.$root.find("#header-input"),this.$headerInput.text=this.store.getState().tableName}onInput(t){var e;this.$dispatch((e=t.target.value,{type:d,text:e}))}onClick(t){if("delete"===e(t.target).data.action){const t=s.param;confirm("Удалить текущую таблицу?")&&(localStorage.removeItem(`excel:${t}`),s.push("dashboard"))}}}!function(t,e,s){e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s}(y,"className","excel__header");class $ extends w{constructor(...t){super(...t)}get template(){return JSON.stringify(this.state,null,2)}initState(t={}){this.state={...t}}setState(t){this.state={...this.state,...t},this.$root.html(this.template)}}function x(t){const e=`\n    data-type="button"\n    data-value='${JSON.stringify(t.value)}'\n  `;return`\n    <div \n      class="button ${t.active?"active":""}"\n      ${e}\n    >\n      <i \n        class="material-icons"\n        ${e}\n      >${t.icon}</i>\n    </div>\n  `}const S={textAlign:"left",fontWeight:"normal",textDecoration:"none",fontStyle:"normal"};class E extends ${constructor(t,e){super(t,{name:"Toolbar",listeners:["click"],subscribe:["currentStyles"],...e})}prepare(){this.initState(S)}get template(){return[{icon:"format_align_left",active:"left"===(t=this.state).textAlign,value:{textAlign:"left"}},{icon:"format_align_center",active:"center"===t.textAlign,value:{textAlign:"center"}},{icon:"format_align_right",active:"right"===t.textAlign,value:{textAlign:"right"}},{icon:"format_bold",active:"bold"===t.fontWeight,value:{fontWeight:"bold"===t.fontWeight?"normal":"bold"}},{icon:"format_italic",active:"italic"===t.fontStyle,value:{fontStyle:"italic"===t.fontStyle?"normal":"italic"}},{icon:"format_underlined",active:"underline"===t.textDecoration,value:{textDecoration:"underline"===t.textDecoration?"none":"underline"}}].map(x).join("");var t}toHTML(){return this.template}storeChanged(t){console.log(1,t),this.setState(t.currentStyles)}onClick(t){const s=e(t.target);if("button"===s.data.type){const t=JSON.parse(s.data.value);this.$emit("toolbar:applyStyle",t)}}}!function(t,e,s){e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s}(E,"className","excel__toolbar");class T{constructor(){this.group=[],this.current=null}clear(){this.group.length>0&&(this.group.forEach((t=>t.removeClass(T.cellActiveClassName))),this.group.length=0)}get selectedIds(){return this.group.map((t=>t.id()))}select(t){this.clear(),this.group.push(t),t.addClass("selected").focus(),this.current=t}selectGroup(t=[]){this.clear(),this.group=t,this.group.forEach((t=>t.addClass(T.cellActiveClassName)))}applyStyle(t){this.group.forEach((e=>e.css(t)))}applyText(t,e){this.group.forEach((s=>{s.text=t,s.attr("data-value",e)}))}}!function(t,e,s){e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s}(T,"cellActiveClassName","selected");class C extends w{constructor(t,e){super(t,{name:"Formula",listeners:["input","keydown"],subscribe:["currentText"],...e})}toHTML(){return'\n      <div class="info">fx</div>\n      <div \n        id="formila-input" \n        class="input" \n        contenteditable \n        spellcheck="false"\n       ></div>\n    '}prepare(){this.selection=new T}init(){super.init(),this.$formula=this.$root.find("#formila-input"),this.$on("table:select",(t=>{this.$formula.text=t.data.value})),this.$on("table:input",(t=>{console.log(t),this.$formula.text=t}))}onInput(t){const e=t.target.textContent.trim();this.$emit("formula:input",e)}onKeydown(t){if(["Enter","Tab"].includes(t.key)){t.preventDefault();const e=t.target.textContent.trim();this.$emit("formula:enter",e)}}}!function(t,e,s){e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s}(C,"className","excel__formula");function k(t,e){return(t[e]||120)+"px"}function A(t,e){return function(s,n){const r=`${e}:${n}`,i=k(t.colState,n),a=t.dataState[r]||"";return`\n      <div \n        class="cell" \n        contenteditable \n        data-col="${n}"\n        data-type="cell"\n        data-id="${r}"\n        data-value="${a||""}"\n        style="${function(t={}){return Object.keys(t).map((e=>{return`${s=e,s.replace(/([A-Z])/g,(t=>`-${t[0].toLowerCase()}`))}: ${t[e]}`;var s})).join(";")}({...S,...t.stylesState[r]})}; width: ${i}"\n      >\n        ${a}\n      </div>\n    `}}function N({col:t,index:e,width:s}){return`\n    <div \n      class="column" \n      data-type="resizable" \n      data-col="${e}" \n      style="width: ${s}"\n    >\n      ${t}\n      <div class="col-resize" data-resize="col"></div>\n    </div>\n  `}function L(t,e,s){const n=t?'<div class="row-resize" data-resize="row"></div>':"";return`\n    <div \n      class="row" \n      data-type="resizable" \n      data-row="${t}"\n      style="height: ${function(t,e){return(t[e]||24)+"px"}(s,t)}"\n    >\n      <div class="row-info">\n        ${t||""}\n        ${n}\n      </div>\n      <div class="row-data">${e}</div>\n    </div>\n  `}function O(t,e){return String.fromCharCode(65+e)}var P=__webpack_require__(781);class j extends w{constructor(t,e){super(t,{name:"Table",listeners:["mousedown","keydown","input"],...e})}toHTML(){return function(t=15,e={}){const s=[],n=new Array(26).fill("").map(O).map(function(t){return function(e,s){return{col:e,index:s,width:k(t.colState,s)}}}(e)).map(N).join("");s.push(L(null,n,{}));for(let n=0;n<t;n++){const t=new Array(26).fill("").map(A(e,n)).join("");s.push(L(n+1,t,e.rowState))}return s.join("")}(20,this.store.getState())}prepare(){this.selection=new T}init(){super.init();const t=this.$root.find('[data-id="0:0"]');this.selectCell(t),this.$on("formula:input",(t=>{this.selection.applyText((0,P.Q)(t),t),this.updateTextInStore()})),this.$on("formula:enter",(t=>{this.selection.current.focus()})),this.$on("toolbar:applyStyle",(t=>{var e;this.selection.applyStyle(t),this.$dispatch((e={value:t,ids:this.selection.selectedIds},{type:u,data:e}))}))}selectCell(t){this.selection.select(t),this.$emit("table:select",t);const e=t.getStyles(Object.keys(S));this.$dispatch({type:h,data:e})}async resizeTable(t){try{const s=await function(t,s,n){if(t.dataset.resize)return new Promise((r=>{const i=e(t),a=i.data.resize,o=i.closest('[data-type="resizable"]'),c=o.getCoords(),l=document.querySelector(`.${n}`),u=s.findAll(`[data-col="${o.data.col}"]`);let h=0,d=0;switch(a){case"col":h=l.scrollHeight,i.addClass("col-resize--active"),i.height(h);break;case"row":h=l.scrollWidth,i.addClass("row-resize--active"),i.width(h)}document.onmousemove=t=>{let e=0;switch(a){case"col":e=t.pageX-c.right,d=c.width+e,i.css({right:-e+"px"});break;case"row":e=t.pageY-c.bottom,d=c.height+e,i.css({bottom:-e+"px"})}},document.onmouseup=()=>{switch(a){case"col":u.forEach((t=>t.style.width=d+"px")),i.removeClass("col-resize--active"),i.css({right:"0px"}),i.height("auto");break;case"row":o.height(d),i.removeClass("row-resize--active"),i.css({bottom:"0px"}),i.width("auto")}r({value:d,resizeType:a,id:o.data[a]}),document.onmouseup=null,document.onmousemove=null}}))}(t.target,this.$root,j.className);this.$dispatch(function(t){return{type:c,data:t}}(s))}catch(t){new Error(t.message)}}async onMousedown(t){if(await this.resizeTable(t),"cell"===t.target.dataset.type){const s=e(t.target);if(t.shiftKey){const t=function(t,e){const s=t.id(!0),n=e.id(!0),r=i(n.col,s.col),a=i(n.row,s.row);return r.reduce(((t,e)=>(a.forEach((s=>t.push(`${s}:${e}`))),t)),[])}(s,this.selection.current).map((t=>this.$root.find(`[data-id="${t}"]`)));this.selection.selectGroup(t)}else this.selectCell(s)}}onKeydown(t){const{key:e}=t;if(["Enter","Tab","ArrowLeft","ArrowRight","ArrowDown","ArrowUp"].includes(e)&&!t.shiftKey){t.preventDefault();const s=this.selection.current.id(!0),n=this.$root.find(function(t,{col:e,row:s}){switch(t){case"Enter":case"ArrowDown":s++;break;case"Tab":case"ArrowRight":e++;break;case"ArrowLeft":e=e-1<0?0:e-1;break;case"ArrowUp":s=s-1<0?0:s-1}return`[data-id="${s}:${e}"]`}(e,s));this.selectCell(n)}}updateTextInStore(){this.selection.group.forEach((t=>{var e;this.$dispatch((e={id:t.id(),value:t.text},{type:l,data:e}))}))}onInput(t){this.$emit("table:input",this.selection.current.text),this.updateTextInStore()}}!function(t,e,s){e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s}(j,"className","excel__table");class H{constructor(t,e=300){this.client=t,this.listen=function(t,e){let s;return function(...n){clearTimeout(s),s=setTimeout((()=>{clearTimeout(s),t.apply(this,n)}),e)}}(this.listen.bind(this),e)}listen(t){this.client.save(t)}get(){return this.client.get()}}const z={rowState:{},colState:{},dataState:{},stylesState:{},currentText:"",currentStyles:S,tableName:"Test table",openTime:0};class I{constructor(t){this.name="excel:"+t}save(t){return a(this.name,t),Promise.resolve()}get(){return new Promise((t=>{const e=a(this.name);setTimeout((()=>{t(e)}),2500)}))}}new class{constructor(t,s){if(!t)throw new Error("Selector is not provided in Router");this.$placeholder=e(t),this.routes=s,this.loader=new n,this.currentPage=null,this.changePageHandler=this.changePageHandler.bind(this),this.init()}init(){window.addEventListener("hashchange",this.changePageHandler),this.changePageHandler()}async changePageHandler(){this.$placeholder.clear().append(this.loader),this.currentPage&&this.currentPage.destroy();const t=s.page,e=this.routes[t]||this.routes.dashboard;this.currentPage=new e(s.param);const n=await this.currentPage.getRoot();this.$placeholder.clear().append(n),this.currentPage.afterRender()}destroy(){window.removeEventListener("hashchange",this.changePageHandler)}}("#app",{dashboard:class extends r{getRoot(){const t=Date.now().toString();return e.create("div","db").html(`\n      <div class="db__header">\n        <h1>Excel. Панель Управления</h1>\n      </div>\n\n      <div class="db__new">\n        <div class="db__view">\n          <a href="#excel/${t}" class="db__create">\n            Новая <br /> Таблица\n          </a>\n        </div>\n      </div>\n\n      <div class="db__table db__view">\n        ${function(){const t=function(){const t=[];for(let e=0;e<localStorage.length;e++){const s=localStorage.key(e);s.includes("excel")&&t.push(s)}return t}();return t.length?`\n    <div class="db__list-header">\n      <span>Название</span>\n      <span>Дата открытия</span>\n    </div>\n\n    <ul class="db__list">\n      ${t.map(o).join("")}\n    </ul>\n  `:"<p>Вы пока не создали ни одной таблицы</p>"}()}\n      </div>\n    `)}},excel:class extends r{constructor(t){super(t),this.storeSub=null,this.processor=new H(new I(this.params))}async getRoot(){const t=function(t,e={}){let s=t({...e},{type:"__INIT__"}),n=[];return{subscribe:t=>(n.push(t),{unsubscribe(){n=n.filter((e=>e!==t))}}),dispatch(e){console.log(e),s=t(s,e),n.forEach((t=>t(s)))},getState:()=>JSON.parse(JSON.stringify(s))}}(f,(e=await this.processor.get())?(t=>({...t,currentStyles:S,currentText:""}))(e):(s=z,JSON.parse(JSON.stringify(s))));var e,s;return this.storeSub=t.subscribe(this.processor.listen),this.excel=new g({components:[y,E,C,j],store:t}),this.excel.getRoot()}afterRender(){this.excel.init()}destroy(){this.excel.destroy(),this.storeSub.unsubscribe()}}})}()})();